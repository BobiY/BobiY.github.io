---
layout: default
title: webpack基础
---
<link rel="stylesheet" href="{{ site.baseurl }}/assets/style.css">
<link rel="stylesheet" href="{{ site.baseurl }}/css/webpack.css">
<link rel="stylesheet" href="{{ site.baseurl }}/css/highLight.css">
<h2>{{ page.title }}</h2>
<p>我的第一篇文章</p>
<p>{{ page.date | date_to_string }}</p>

<h3>安装Nodejs</h3>

<p>webpack是一个前端流行的打包和编译工具，在学习以前，需要你确认你的电脑上已经安装好 nodejs</p>

<h3>下面，我们将以一个简单的路由项目来展示webpack的用法</h3>

<p>首先，你需要找个目录，新建一个加 simple 的文件夹，我们的示例项目将会在这里面展开.下面是目录结构，仅供参考</p>
<p class="back">
    ├── dist &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    打包输出目录, 只需部署这个目录到生产环境<br />
    ├── package.json  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            项目配置信息 <br />
    ├── node_modules  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            npm安装的依赖包都在这里面 <br />
    ├── src      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                 我们的源代码 <br />
    │   ├── components   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         可以复用的模块放在这里面 <br />
    │   ├── index.html   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         入口html <br />
    │   ├── index.js   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           入口js <br />
    │   ├── libs       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;          不在npm和git上的库扔这里 <br />
    │   └── views        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           页面放这里 <br />
    └── webpack.config.js   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        webpack 配置文件 <br />
</p>

<p>然后在你刚才建的simple文件夹中打开命令行，输入 npm init</p>
<p>这时会生成一些项目的配置信息，这里可以一路回车下去，最终，会将这些信息会默认生成到 package.json 的文件中</p>
<h3 class="title">给项目加上语法报错和代码规范检查</h3>
<p>这里要安装 esLint 来对你的代码的正确性做出判断，这个检测对于新手来说不太友好，往往会产生意想不到的报错，虽然只是你书写的 js 语法部分，当然，现在的一些编辑器也有同样的功能</p>

<p class="back">
    npm install eslint eslint-config-enough eslint-loader --save-dev
</p>
<p>
    npm 允许你一次安装多个包，这些包的名字用空格隔开即可，这些包会被安装进 node_modules 目录下
</p>
<p>
    这里说一下 --save-dev 和 --save 的异同：&nbsp;&nbsp;&nbsp; --save-dev会把安装的包和版本号记录到package.json中的devDependencies对象中, 还有一个--save, 会记录到dependencies对象中, 它们的区别, 我们可以先简单的理解为打包工具和测试工具用到的包使用--save-dev存到devDependencies, 比如eslint, webpack. 浏览器中执行的js用到的包存到dependencies, 比如jQuery等. 那么它们用来干嘛的? 
</p>
<p>
    因为有些npm包安装是需要编译的, 那么导致windows/mac/linux上编译出的可执行文件是不同的, 也就是无法通用, 因此我们在提交代码到git上去的时候, 一般都会在.gitignore里指定忽略node_modules目录和里面的文件, 这样其他人从git上拉下来的项目是没有node_modules目录的, 这时我们需要运行
</p>
<p class="back">
    npm install
</p>
<p>
    它会读取package.json中的devDependencies和dependencies字段, 把记录的包的相应版本下载下来.
</p>
<p>
    这里eslint-config-enough是配置文件, 它规定了代码规范, 要使它生效, 我们要在package.json中添加内容:
</p>
<p class="back">
      {% highlight javascript %}
      {
        "eslintConfig": {
          "extends": "enough",
          "env": {
            "browser": true,
            "node": true
          }
        }
      }
      {% endhighlight %}
</p>
<p class="tip">* esLint 刚开始使用时会不适应，而且也不是必须的，这步可以考虑先跳过，熟悉后再进行配置</p>
<p>
    下面需要写几个必要的页面，以确保我们的应用能跑起来
</p>
<p>
        我们写一个最简单的SPA应用来介绍SPA应用的内部工作原理. 首先, 建立src/index.html文件, 内容如下:
</p>
{% highlight javascript %}
    <!DOCTYPE html>
      <html>
        <head>
          <meta charset="utf-8">
        </head>
        <body>
        </body>
    </html>
{% endhighlight %}
<p>
        它是一个空白页面, 注意这里我们不需要自己写&lt;script src="index.js"&gt;&lt;/script&gt;, 因为打包后的文件名和路径可能会变, 所以我们用webpack插件帮我们自动加上.
</p>
<p>
        然后重点是src/index.js:
</p>
{% highlight javascript %}
// 引入作为全局对象储存空间的global.js, js文件可以省略后缀

import g from './global'

// 引入页面文件
import foo from './views/foo'
import bar from './views/bar'

const routes = {
  '/foo': foo,
  '/bar': bar
}

// Router类, 用来控制页面根据当前URL切换
class Router {
  start() {
    // 点击浏览器后退/前进按钮时会触发window.onpopstate事件, 我们在这时切换到相应页面
    // https://developer.mozilla.org/en-US/docs/Web/Events/popstate
    window.addEventListener('popstate', () => {
      this.load(location.pathname)
    })

    // 打开页面时加载当前页面
    this.load(location.pathname)
  }

  // 前往path, 会变更地址栏URL, 并加载相应页面
  go(path) {
    // 变更地址栏URL
    history.pushState({}, '', path)
    // 加载页面
    this.load(path)
  }

  // 加载path路径的页面
  load(path) {
    // 创建页面实例
    const view = new routes[path]()
    // 调用页面方法, 把页面加载到document.body中
    view.mount(document.body)
  }
}

// new一个路由对象, 赋值为g.router, 这样我们在其他js文件中可以引用到
g.router = new Router()
// 启动
g.router.start()
{% endhighlight %}

